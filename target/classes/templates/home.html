<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - FUCarRentingSystem</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">FUCarRenting</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="home">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="customer/rental">Rental</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="customer/profile">Profile</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-danger" href="#" id="logout">Logout</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h2 class="mb-4">Available Cars</h2>
    <div class="row" id="carList">
        <!-- Car cards will be injected here -->
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const token = localStorage.getItem('accessToken');

        fetch('../de180293/api/cars', {
        })
            .then(response => response.json())
            .then(data => {
                const carList = document.getElementById('carList');
                if (data.result && data.result.length > 0) {
                    data.result.forEach(car => {
                        const card = document.createElement('div');
                        card.className = 'col-md-4';

                        const isAvailable = car.status !== 'FULLSLOT';

                        card.innerHTML = `
                                        <div class="card mb-4 shadow-sm">
                                            <div class="card-body">
                                                <h5 class="card-title">${car.carName} (${car.carModelYear})</h5>
                                                <p class="card-text">
                                                    <strong>Color:</strong> ${car.color}<br>
                                                    <strong>Capacity:</strong> ${car.capacity} seats<br>
                                                    <strong>Price:</strong> $${car.rentPrice} / day<br>
                                                    <strong>Status:</strong> <span class="${isAvailable ? 'text-success' : 'text-danger'}">${car.status}</span>
                                                </p>
                                                ${isAvailable
                                                            ? `<button class="btn btn-primary" onclick="rentCar('${car.carId}')">Rent This Car</button>`
                                                            : `<button class="btn btn-secondary" disabled>Unavailable</button>`
                                                        }
                                            </div>
                                        </div>
                                    `;
                        carList.appendChild(card);
                    });

                } else {
                    carList.innerHTML = '<div class="alert alert-warning">No cars available at the moment.</div>';
                }
            });
    });

    function rentCar(carId) {
        // alert("Feature coming soon for car: " + carId);
        localStorage.setItem("selectedCarId", carId);  // hoặc sessionStorage
        window.location.href = `customer/rent-car?carId`;
    }
</script>

<!-- LOGOUT -->
<script>
    document.getElementById('logout').addEventListener('click', function (e) {
        e.preventDefault();

        // Xoá JWT token trong localStorage
        localStorage.removeItem("accessToken");
        localStorage.removeItem("username");
        localStorage.removeItem("role");

        fetch('http://localhost:8080/de180293/api/auth/logout', {
            method: 'POST',
            credentials: 'include' // để gửi cookie theo request
        })
            .then(res => res.json())
            .then(data => {
                console.log(data.message);
            });


        // Chuyển hướng về trang login
        window.location.href = "./auth/login";
    });

</script>
</body>
</html>
